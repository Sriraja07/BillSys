{% extends "base.html" %}

{% block title %}Edit Product - Electrical Billing Software{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center space-x-4 mb-4">
            <a href="{{ url_for('products') }}" class="text-blue-600 hover:text-blue-800 flex">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3 24 24" fill="currentColor" class="size-5 mr-2">
                    <path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                  </svg>
                  Back to Products
            </a>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">Edit Product</h1>
        <p class="text-gray-600">Update product details below</p>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <form method="POST" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Product Name -->
                <div class="md:col-span-2">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        Product Name *
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        required 
                        value="{{ product.name }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter product name"
                    >
                </div>

                <!-- Category -->
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700 mb-2">
                        Category *
                    </label>
                    <select 
                        id="category" 
                        name="category" 
                        required 
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="">Select Category</option>
                        <option value="Lighting" {% if product.category == 'Lighting' %}selected{% endif %}>Lighting</option>
                        <option value="Switches" {% if product.category == 'Switches' %}selected{% endif %}>Switches</option>
                        <option value="Cables" {% if product.category == 'Cables' %}selected{% endif %}>Cables</option>
                        <option value="Sockets" {% if product.category == 'Sockets' %}selected{% endif %}>Sockets</option>
                        <option value="Fans" {% if product.category == 'Fans' %}selected{% endif %}>Fans</option>
                        <option value="Motors" {% if product.category == 'Motors' %}selected{% endif %}>Motors</option>
                        <option value="MCB" {% if product.category == 'MCB' %}selected{% endif %}>MCB</option>
                        <option value="Stabilizers" {% if product.category == 'Stabilizers' %}selected{% endif %}>Stabilizers</option>
                        <option value="Inverters" {% if product.category == 'Inverters' %}selected{% endif %}>Inverters</option>
                        <option value="Batteries" {% if product.category == 'Batteries' %}selected{% endif %}>Batteries</option>
                        <option value="Others" {% if product.category == 'Others' %}selected{% endif %}>Others</option>
                    </select>
                </div>

                <!-- Brand -->
                <div>
                    <label for="brand" class="block text-sm font-medium text-gray-700 mb-2">
                        Brand *
                    </label>
                    <input 
                        type="text" 
                        id="brand" 
                        name="brand" 
                        required 
                        value="{{ product.brand }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter brand name"
                    >
                </div>

                <!-- MRP Price -->
                <div>
                    <label for="mrp_price" class="block text-sm font-medium text-gray-700 mb-2">
                        MRP Price (₹) *
                    </label>
                    <input 
                        type="number" 
                        id="mrp_price" 
                        name="mrp_price" 
                        step="0.01" 
                        min="0" 
                        required 
                        value="{{ product.mrp_price }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="0.00"
                    >
                </div>

                <!-- Cost Price -->
                <div>
                    <label for="cost_price" class="block text-sm font-medium text-gray-700 mb-2">
                        Cost Price (₹) *
                    </label>
                    <input 
                        type="number" 
                        id="cost_price" 
                        name="cost_price" 
                        step="0.01" 
                        min="0" 
                        required 
                        value="{{ product.cost_price }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="0.00"
                    >
                </div>

                <!-- Selling Price -->
                <div>
                    <label for="selling_price" class="block text-sm font-medium text-gray-700 mb-2">
                        Selling Price (₹) *
                    </label>
                    <input 
                        type="number" 
                        id="selling_price" 
                        name="selling_price" 
                        step="0.01" 
                        min="0" 
                        required 
                        value="{{ product.selling_price }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="0.00"
                    >
                </div>

                <!-- GST Rate -->
                <div>
                    <label for="gst_rate" class="block text-sm font-medium text-gray-700 mb-2">
                        GST Rate (%) *
                    </label>
                    <select 
                        id="gst_rate" 
                        name="gst_rate" 
                        required 
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="">Select GST Rate</option>
                        <option value="0" {% if product.gst_rate == 0 %}selected{% endif %}>0%</option>
                        <option value="5" {% if product.gst_rate == 5 %}selected{% endif %}>5%</option>
                        <option value="12" {% if product.gst_rate == 12 %}selected{% endif %}>12%</option>
                        <option value="18" {% if product.gst_rate == 18 %}selected{% endif %}>18%</option>
                        <option value="28" {% if product.gst_rate == 28 %}selected{% endif %}>28%</option>
                    </select>
                </div>
                <!-- GST Rate -->
                <div>
                    <label for="unit" class="block text-sm font-medium text-gray-700 mb-2">
                        Unit *
                    </label>
                    <select 
                        id="unit" 
                        name="unit" 
                        required 
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Units</option>
                        <option value="Mtr" {% if product.unit == "Mtr" %}selected{% endif %}>Meter</option>
                        <option value="Pcs" {% if product.unit == "Pcs" %}selected{% endif %}>Pieces</option>
                        <option value="Nos" {% if product.unit == "Nos" %}selected{% endif %}>Numbers</option>
                        <option value="KGs" {% if product.unit == "KGs" %}selected{% endif %}>KiloGram</option>
                    </select>
                </div>

                <!-- Stock Quantity -->
                <div>
                    <label for="stock_quantity" class="block text-sm font-medium text-gray-700 mb-2">
                        Stock Quantity *
                    </label>
                    <input 
                        type="number" 
                        id="stock_quantity" 
                        name="stock_quantity" 
                        min="0" 
                        required 
                        value="{{ product.stock_quantity }}"
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="0"
                    >
                </div>

                <!-- Vendor -->
                <div>
                    <label for="vendor_id" class="block text-sm font-medium text-gray-700 mb-2">
                        Vendor (Optional)
                    </label>
                    <select 
                        id="vendor_id" 
                        name="vendor_id" 
                        class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="">Select Vendor</option>
                        {% for vendor in vendors %}
                            <option value="{{ vendor.id }}" {% if product.vendor_id == vendor.id %}selected{% endif %}>{{ vendor.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Product Stats -->
            <div class="bg-blue-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-gray-700 mb-2">Product Statistics</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-gray-600">Created:</span>
                        <span class="font-medium text-gray-900 ml-2">{{ product.created_at.strftime('%d %b %Y') }}</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Product ID:</span>
                        <span class="font-medium text-blue-600 ml-2">#{{ product.id }}</span>
                    </div>
                </div>
            </div>

            <!-- Profit Margin Display -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="text-sm font-medium text-gray-700 mb-2">Profit Analysis</h3>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-gray-600">Profit Margin:</span>
                        <span id="profitMargin" class="font-medium text-green-600 ml-2">-</span>
                    </div>
                    <div>
                        <span class="text-gray-600">Profit Amount:</span>
                        <span id="profitAmount" class="font-medium text-green-600 ml-2">-</span>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="{{ url_for('products') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-md transition-colors duration-200">
                    Cancel
                </a>
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors duration-200">
                    Update Product
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Calculate profit margin and amount
    function calculateProfit() {
        const costPrice = parseFloat(document.getElementById('cost_price').value) || 0;
        const sellingPrice = parseFloat(document.getElementById('selling_price').value) || 0;
        
        if (costPrice > 0 && sellingPrice > 0) {
            const profitAmount = sellingPrice - costPrice;
            const profitMargin = ((profitAmount / costPrice) * 100).toFixed(2);
            
            document.getElementById('profitMargin').textContent = profitMargin + '%';
            document.getElementById('profitAmount').textContent = '₹' + profitAmount.toFixed(2);
            
            // Change color based on profit
            const marginElement = document.getElementById('profitMargin');
            const amountElement = document.getElementById('profitAmount');
            
            if (profitAmount < 0) {
                marginElement.className = 'font-medium text-red-600 ml-2';
                amountElement.className = 'font-medium text-red-600 ml-2';
            } else if (profitMargin < 10) {
                marginElement.className = 'font-medium text-yellow-600 ml-2';
                amountElement.className = 'font-medium text-yellow-600 ml-2';
            } else {
                marginElement.className = 'font-medium text-green-600 ml-2';
                amountElement.className = 'font-medium text-green-600 ml-2';
            }
        } else {
            document.getElementById('profitMargin').textContent = '-';
            document.getElementById('profitAmount').textContent = '-';
        }
    }

    // Add event listeners
    document.getElementById('cost_price').addEventListener('input', calculateProfit);
    document.getElementById('selling_price').addEventListener('input', calculateProfit);

    // Form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const costPrice = parseFloat(document.getElementById('cost_price').value) || 0;
        const sellingPrice = parseFloat(document.getElementById('selling_price').value) || 0;
        const mrpPrice = parseFloat(document.getElementById('mrp_price').value) || 0;

        if (sellingPrice > mrpPrice) {
            e.preventDefault();
            alert('Selling price cannot be higher than MRP price!');
            return false;
        }

        if (costPrice > sellingPrice) {
            const confirmed = confirm('Cost price is higher than selling price. This will result in a loss. Are you sure you want to continue?');
            if (!confirmed) {
                e.preventDefault();
                return false;
            }
        }
    });

    // Initialize profit calculation
    calculateProfit();
</script>
{% endblock %} 